@using Card_App.Models.Service
@using Microsoft.AspNetCore.Authorization
@using System.Web
@inject IAuthorizationService AuthorizationService

@model ServiceViewModel
@{
    ViewData["Title"] = "Listado de Servicios";
}
<link rel="stylesheet" type="text/css" href="~/css/datatables.min.css" />
<div class="container-fluid">

    <div class="row">
        <div class="col-12">
            <div class="card bg-bgcontent-dark rounded shadow-sm mb-3">
                <div class="card-header fw-bold">Lista General</div>
                 <div class="card-body">
                    <form class="row" asp-action="Service" id="frmIdc">
                        <div class="col-sm-4">
                            <label asp-for="CommerceDTO.businessName" class="form-label"></label>
                            <select id="businessName" asp-for="CommerceDTO.businessName" asp-items="Model.CommerceDropDown" class="form-select form-select-sm">
                                <option selected disabled value="">Elegir...</option>
                            </select>
                            <span asp-validation-for="CommerceDTO.businessName" class="validation-text-danger"></span>
                        </div>
                        </form>
                </div>
                </div>
                </div>
                </div>
                    <div class="row">
        <div class="col-12">
            <div class="card bg-bgcontent-dark rounded shadow-sm mb-3">
                <div class="card-header fw-bold">Lista General</div>
                  @if (Model != null && Model.ServiceResponse.services != null)
                {
                <table id="tblService" class="table bg-bgcontent-dark table-sm text-light p-4  shadow-sm mb-3 rounded">
                    <thead>
                        <tr class=text-opacity-75>
                            <th scope="col">#</th>
                            <th scope="col">Nombre</th>
                            <th scope="col">Descripción</th>
                            <th scope="col">Cod. Servicio</th>
                            <th scope="col">Descuento %</th>
                            <th scope="col">Tipo</th>                            
                            <th scope="col">Ciudad</th>                            
                            <th scope="col">Fecha Inicio</th>                            
                            <th scope="col">Fecha Fin</th>                                                        
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in @Model.ServiceResponse.services)
                        {                                                        
                        <tr>
                            <td></td>
                            <td>@item.name</td>
                            <td>@item.description</td>                            
                            <td>@item.serviceCode</td>
                            <td>@item.discountText</td>
                            <td>@item.type</td>                          
                            <td>@item.city</td>                          
                            <td>@item.startDate</td>                          
                            <td>@item.endDate</td>                          
                            <td></td>                          
                            <td></td>                          
                        </tr>
                        }

                    </tbody>
                </table>
                 }
                else
                {
                    <div class="row">
                        <div class="col">
                            <div class="alert alert-success">No seleccionó un Comercio</div>
                        </div>
                    </div>
                }
            </div>
            </div>
            </div>
            </div>
            

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script src="~/js/datatables.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#tblService').dataTable({
                "info": false,
                "lengthMenu": [5, 25, 50],
                "language": {
                    "search": "Filtrar:",
                    "lengthMenu": "Mostar _MENU_",
                    "paginate": {
                        "first": "Primero",
                        "last": "Último",
                        "next": "Siguiente",
                        "previous": "Atras"
                    }
                }
            });
        });
         (function() {
    var rows = document.getElementById("tblService").rows;
    for(var i = 1; i <= rows.length; i++) {
      rows[i-1].id = 'Row'+i;
        console.log(i);
    }  
 })();
        function sendRow(id) {
            let renglonPorEnviar = miArray.find(x => x.id == id);
            $.ajax({
                url: "tu/url",
                data: renglonPorEnviar,
                type: "POST",
                dataType: "Json",
                success: function (data) { }
            });
        };
        $(".btnEdit").on("click", function (e) {
            e.preventDefault();
            HabilitarButtons();
            tr = $(this).closest('tr');
            console.log(tr.find("td:eq(1)").text());
            var ProdOld = tr.find("td:eq(1)").text();
            var valorProdOld = ProdOld.split("-");
            console.log(valorProdOld[0]);
            document.getElementById("ProductoOld").value = valorProdOld[0].replace(/ /g, "");
            document.getElementById("Producto").value = valorProdOld[0].replace(/ /g, "");
            
            if (tr.find("td:eq(2)").text() == "BOB") {
                document.getElementById("rbtMonedaOldBol").checked = true;
                document.getElementById("rbtMonedaOldDol").checked = false;
                document.getElementById("rbtMonedaBol").checked = true;
                document.getElementById("rbtMonedaDol").checked = false;
            }
            else {
                document.getElementById("rbtMonedaOldBol").checked = false;
                document.getElementById("rbtMonedaOldDol").checked = true;
                document.getElementById("rbtMonedaBol").checked = false;
                document.getElementById("rbtMonedaDol").checked = true;
            }
            document.getElementById("Minimo").value = tr.find("td:eq(3)").text();
            document.getElementById("Maximo").value = tr.find("td:eq(4)").text();
            document.getElementById("Promedio").value = tr.find("td:eq(5)").text();
            console.log(tr.find("td:eq(6)").text());
            if (tr.find("td:eq(6)").text() == "true") {
                document.getElementById("cbEstado").checked = true;
            }
            else {
                document.getElementById("cbEstado").checked = false;
            }

        });
        function HabilitarButtons() {
            $("button#btnModificar").attr('disabled', false);
        };
        function DeshabilitarButtons() {
            $("button#btnModificar").attr('disabled', true);
        };
        function Limpiar() {
            DeshabilitarButtons();
            location.reload();
        };
         function Edit() {
            $("form#frmIdc").attr("action", "@Url.Action("ModificarIndiceCobros", "IndiceCobros")");
            $("form#frmIdc").submit();
        };
    </script>
}
