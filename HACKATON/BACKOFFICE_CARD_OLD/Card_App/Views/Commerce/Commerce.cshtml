@using Card_App.Models.Commerce
@using Microsoft.AspNetCore.Authorization
@using System.Web
@inject IAuthorizationService AuthorizationService

@model CommerceViewModel
@{
    ViewData["Title"] = "Listado de Comercios";
}
<link rel="stylesheet" type="text/css" href="~/css/datatables.min.css" />
<div class="container-fluid">

    <div class="row">
        <div class="col-12">
            <div class="card bg-bgcontent-dark rounded shadow-sm mb-3">
                <div class="card-header fw-bold">Lista General</div>
                <table id="tblCommerce" class="table bg-bgcontent-dark table-sm text-light p-4  shadow-sm mb-3 rounded">
                    <thead>
                        <tr class=text-opacity-75>
                            <th scope="col">#</th>
                            <th scope="col">Nombre</th>
                            <th scope="col">Código Comercio</th>
                            <th scope="col">Nombre Empresa</th>
                            <th scope="col">NIT</th>                            
                            <th scope="col">Teléfono</th>                            
                            <th scope="col">Ciudad</th>                           
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in @Model.CommerceResponse.data.commerces)
                        {                                                     
                        <tr>
                            <td></td>
                            <td>@item.name</td>                            
                            <td>@item.commerceCode</td>
                            <td>@item.businessName</td>
                            <td>@item.nit</td>                          
                            <td>@item.phoneNumber</td>                          
                            <td>@item.city</td>               
                        </tr>
                        }                            
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script src="~/js/datatables.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#tblCommerce').dataTable({
                "info": false,
                "lengthMenu": [5, 25, 50],
                "language": {
                    "search": "Filtrar:",
                    "lengthMenu": "Mostar _MENU_",
                    "paginate": {
                        "first": "Primero",
                        "last": "Último",
                        "next": "Siguiente",
                        "previous": "Atras"
                    }
                }
            });
        });
         (function() {
    var rows = document.getElementById("tblCommerce").rows;
    for(var i = 1; i <= rows.length; i++) {
      rows[i-1].id = 'Row'+i;
        console.log(i);
    }  
 })();
        function sendRow(id) {
            let renglonPorEnviar = miArray.find(x => x.id == id);
            $.ajax({
                url: "tu/url",
                data: renglonPorEnviar,
                type: "POST",
                dataType: "Json",
                success: function (data) { }
            });
        };
        $(".btnEdit").on("click", function (e) {
            e.preventDefault();
            HabilitarButtons();
            tr = $(this).closest('tr');
            console.log(tr.find("td:eq(1)").text());
            var ProdOld = tr.find("td:eq(1)").text();
            var valorProdOld = ProdOld.split("-");
            console.log(valorProdOld[0]);
            document.getElementById("ProductoOld").value = valorProdOld[0].replace(/ /g, "");
            document.getElementById("Producto").value = valorProdOld[0].replace(/ /g, "");
            
            if (tr.find("td:eq(2)").text() == "BOB") {
                document.getElementById("rbtMonedaOldBol").checked = true;
                document.getElementById("rbtMonedaOldDol").checked = false;
                document.getElementById("rbtMonedaBol").checked = true;
                document.getElementById("rbtMonedaDol").checked = false;
            }
            else {
                document.getElementById("rbtMonedaOldBol").checked = false;
                document.getElementById("rbtMonedaOldDol").checked = true;
                document.getElementById("rbtMonedaBol").checked = false;
                document.getElementById("rbtMonedaDol").checked = true;
            }
            document.getElementById("Minimo").value = tr.find("td:eq(3)").text();
            document.getElementById("Maximo").value = tr.find("td:eq(4)").text();
            document.getElementById("Promedio").value = tr.find("td:eq(5)").text();
            console.log(tr.find("td:eq(6)").text());
            if (tr.find("td:eq(6)").text() == "true") {
                document.getElementById("cbEstado").checked = true;
            }
            else {
                document.getElementById("cbEstado").checked = false;
            }

        });
        function HabilitarButtons() {
            $("button#btnModificar").attr('disabled', false);
        };
        function DeshabilitarButtons() {
            $("button#btnModificar").attr('disabled', true);
        };
        function Limpiar() {
            DeshabilitarButtons();
            location.reload();
        };
         function Edit() {
            $("form#frmIdc").attr("action", "@Url.Action("ModificarIndiceCobros", "IndiceCobros")");
            $("form#frmIdc").submit();
        };
    </script>
}
